import os as operating_system
from sys import platform
from pyfiglet import Figlet
import json
import phonenumbers
from phonenumbers import carrier as network
from phonenumbers import geocoder as locate
from tabulate import tabulate
from urllib.request import urlopen

class Sim_Number_Analyzer(object):
    def __init__(self, number):
        self.number = phonenumbers.parse(number)
        self.url = "https://ipinfo.io/"
    
    def Analyzer(self):
        descriptoon = locate.description_for_number(self.number,"en")
        net_carrier = network.name_for_number(self.number,"en")
        url_response = urlopen(self.url)
        data = json.load(url_response)
        return [descriptoon,net_carrier,data]

    @property
    def Parse_data(self):
        country, net_carrier,device = self.Analyzer()
        region = device["region"]
        city = device["city"]
        latitude,longitude = str(device["loc"]).split(",")
        location = f"Latitude :{latitude},Longitude : {longitude}"
        postal = device["postal"]
        timezone = device["timezone"]
        server = device["org"]
        hostname = device["hostname"]
        device_ip = device["ip"]
        return [["Country",country],
                ["Region",region],
                ["City",city],
                ["Location",location],
                ["Postal",postal],
                ["Timezone",timezone],
                ["Server",server],
                ["Hostname",hostname],
                ["Network",net_carrier],
                ["IP Address",device_ip]]
    def __str__(self) -> str:
        return str(f"\n{tabulate(self.Parse_data)}")
    
class Art:
    def __init__(self,text)->None:
        self.text = text
    def Generate_Art(self):
        Text = Figlet(font = "slant")
        if platform == "linux" or platform == "linux2":
            operating_system.system("clear")
        if platform == "win32":
            operating_system.system("cls")
        operating_system.system("mode con : cols = 75 lines = 30")
        return str(Text.renderText(self.text))

def main():
    print(Art("Sim Number Analyzer").Generate_Art())
    number = input("ei : +2712345678\nEnter number : ")
    print(Sim_Number_Analyzer(number))
if __name__=="__main__":
    main()
